# Genome sequence matching in a cloud cluster
### January 2015

## Introduction

The document describes how to run Demo showing a genome sequence matching in the cloud. 


## Public cloud

For the Demo we use Digital Ocean public cloud provider (www.digitalocean.com). We use Digital Ocean because of its simplicity. Any cloud can be used with a minor adjustment of the cloud setup procedure. 

## Compilation

First download the source code:

	git clone https://github.com/cloudozer/BWT.git

Create a directory for files containing genome data:

	mkdir bwt_files

Demo uses the next files:
	human_g1k_v37_decoy.fasta
	human_g1k_v37_decoy.fasta.index
	SRR770176_1.fastq

Run 
	./rebar get-deps compile 

to compile the source code.


## Cluster setup
To set up a cluster of N nodes we need to run a script:

This script starts N small virtual servers. Every server has three files containing reference genome, index, and query sequences. After booting an erlang application (worker) starts and is waiting for its tasks.
A master node sends a schedule to each node pointing which parts of genome is assigned to a particular worker.


## Starting genome sequence matching

Run 

	./start.sh

script to start the sequence matching process. The script uses all available nodes belonging to the cluster.When a worker finds a match it sends a message to the master node indicating the query sequence name, position in the reference genome and the output generated by smith-waterman algo.


## Terminating sequence matching

The process of sequence matching will finishes when all query sequencces are matched against reference sequence. However, the process can be terminated earlier by running a script ____, which terminates all workers. The cluster will be shotdown automatically if it is idle during 60 minutes.


